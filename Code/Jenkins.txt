def pompath = "Code"
def tomcatdirectory = "C:\\Program Files\\Apache Software Foundation\\Tomcat 7.0"
pipeline {
    agent any 
	     environment {
			PATH = "C:\\WINDOWS\\SYSTEM32"
		}
	parameters { choice(name: 'REQUESTED_ACTION', choices: ['Package', 'Sonar Analysis'], description: '') }
    stages {
        stage('Checkout from SCM ') { 
            steps {
               git credentialsId: 'GitHub_Credential_raghav', url: 'https://github.com/jha-raghav/HappyTrip.git'
            }
        }
		stage('Build') {
			 tools {
	           jdk 'JDK8'
	           maven 'Maven'
	 }
	     when {
                expression { params.REQUESTED_ACTION == 'Package' }
            }
		  steps {
		  dir(pompath) {
                 echo "Hello World"
}
		       
		   }
		}				
			stage('Deploy to PROD') { 
	        steps {
			 script{
			   	env.RELEASE_INPUT = input(message: 'Do you want to trigger release for the current Artefacts ?', ok: 'RELEASE !', submitter: 'PM', parameters: [ booleanParam(name: 'Go For Release', defaultValue: false, description: '')])
				if(env.RELEASE_INPUT){
				 bat 'copy /y "C:\\Program Files (x86)\\Jenkins\\workspace\\HappyTrip-pipeline\\Code\\target\\*.war" "C:\\Program Files\\Apache Software Foundation\\Tomcat 7.0\\webapps\\happytrip.war"'
				}
			}
			}
        }			
			stage('Build and Sonar Analysis') {
			 tools {
	           jdk 'JDK8'
	           maven 'Maven'
	 }
	     when {
                expression { params.REQUESTED_ACTION == 'Sonar Analysis' }
            }
		  steps {
		  withSonarQubeEnv('SonarQube Server') {
		  dir(pompath) {
                    bat 'mvn package sonar:sonar'
}
}
		       
		   }
		}
       
    }
}
