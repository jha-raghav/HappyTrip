def pompath = "Code"
pipeline {
    agent any 
	     environment {
			PATH = "C:\\WINDOWS\\SYSTEM32"
		}
	parameters { choice(name: 'REQUESTED_ACTION', choices: ['Package', 'Sonar Analysis'], description: '') }
    stages {
        stage('Checkout from SCM ') { 
            steps {
               git credentialsId: 'GitHub_Credential_raghav', url: 'https://github.com/jha-raghav/HappyTrip.git'
            }
        }
		stage('Build') {
			 tools {
	           jdk 'JDK8'
	           maven 'Maven'
	 }
	     when {
                expression { params.REQUESTED_ACTION == 'Package' }
            }
		  steps {
		  dir(pompath) {
                  bat 'mvn package'
}
		       
		   }
		}
			stage('Build and Sonar Analysis') {
			 tools {
	           jdk 'JDK8'
	           maven 'Maven'
	 }
	     when {
                expression { params.REQUESTED_ACTION == 'Sonar Analysis' }
            }
			withSonarQubeEnv('SonarQube Server') {
            steps {
		  dir(pompath) {
                    bat 'mvn package sonar:sonar'
}
		       
		   }
              }
		}
       
    }
}
